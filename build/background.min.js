!function(a,b){"use strict";var c=function(){};c.prototype={resetDefaultSuggestion:function(){chrome.omnibox.setDefaultSuggestion({description:"<url><match>src:</match></url> Search KKBOX song"})},search:function(b,c){var d,e,f=this;return d=tester.server+"?action=chr_query&keyword="+b,e=new XMLHttpRequest,e.open("GET",d,!0),e.onreadystatechange=function(b){return function(){if(4===e.readyState){try{var d=JSON.parse(e.responseText);-1===d.status&&(a.alert("needs to reconnect"),b.reconnect()),-2===d.status}catch(f){a.alert(e.responseText)}c(e.responseText)}}}(f),e.send(null),e},updateDefaultSuggestion:function(a){var b=a;chrome.omnibox.setDefaultSuggestion({description:b})},reconnect:function(){console.log("later on we try to reconnect to server"),b.ajax({type:"POST",url:tester.server+"index.php",data:{acc:tester.acc,pwd:tester.pwd,login:1}}).done(function(a){console.log(a)})},htmlEntities:function(a){var b=a.replace(/[\u00A0-\u9999<>\&]/gim,function(a){return"&#"+a.charCodeAt(0)+";"});return b},sanitize:function(a){return a.replace(/[&\/\\#,+$~%.'":*?<>{}]/g,"")}},a.MusicInstant=c}(window,$),function(a,b){"use strict";var c=null,d=new a.MusicInstant,e=null;requirejs.config({baseUrl:"public/js/lib",paths:{app:"public/js"},shim:{jquery:{exports:"jquery"},bootstrap:{deps:["jquery"]}}}),chrome.omnibox.onInputChanged.addListener(function(b,f){return null!==c&&(c.onreadystatechange=null,c.abort(),c=null)," "===b?void f([{content:"select music data",description:"type singer/song name..."}]):(d.updateDefaultSuggestion("select music..."),e&&(clearTimeout(e),console.log("no response")),void(""!==b&&(e=setTimeout(function(){c=d.search(b,function(b){var c=JSON.parse(b),e=[],g=0;for(g=0;g<c.length&&10>g;g+=1)a.localStorage.setItem(g+1,JSON.stringify(c[g])),e.push({content:g+1+" ",description:d.sanitize(c[g].song_name)+"_"+d.sanitize(c[g].artist_name)+"_"+d.sanitize(c[g].album_name)});f(e)})},500))))}),chrome.omnibox.onInputEntered.addListener(function(c){var d=a.localStorage.getItem(c.trim()),e=JSON.parse(d);a.music=c.trim(),b("#player").jPlayer("clearMedia").jPlayer("setMedia",{mp3:e.song_link}).jPlayer("play");var f={type:"basic",title:e.artist_name,message:e.song_name+"\n"+e.album_name,iconUrl:e.album_photo};chrome.notifications.create("",f,function(){})}),chrome.omnibox.onInputStarted.addListener(function(){d.updateDefaultSuggestion("select the music to play")}),chrome.omnibox.onInputCancelled.addListener(function(){d.resetDefaultSuggestion()}),d.resetDefaultSuggestion(),b("#player").jPlayer({ready:function(){b(this).jPlayer("setMedia",{mp3:""})},supplied:"mp3",swfPath:"public/js/lib/jplayer"}),chrome.runtime.onMessage.addListener(function(a,c){console.log(c.tab?"from a content script:"+c.tab.url:"from the extension"),console.log(a),"stop"==a.status&&b("#player").jPlayer("stop"),"play"==a.status&&b("#player").jPlayer("play"),"pause"==a.status&&b("#player").jPlayer("pause")})}(window,$);