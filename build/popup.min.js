!function(){"use strict";define(["jquery","underscore","backbone","jplayer/jquery.jplayer.min"],function(a,b,c){var d,e,f,g,h,i;d=c.Model.extend({defaults:{index:0,album:"",artist:"artists",song:"unnamed song",link:""}}),e=c.Collection.extend({songlist:[],initialize:function(){},request:function(){console.log("request song")},add:function(a){this.set([a]),console.log("add song: "+a)}}),f=c.View.extend({playIdx:0,el:a("body"),initialize:function(){console.log("produce playlist")},backward:a("#backward"),forward:a("#forward"),viewList:a("#viewPlaylist"),events:{"click #backward":"last","click #forward":"next",playNextSong:"next",playLastSong:"last"},next:function(){console.log("play next song."),this.listenTo(this.playlist,"change",this.sync),this.playIdx+=1},last:function(){console.log("play last song."),this.playIdx-=1},play:function(){console.log("play song: "+this.idx)},stop:function(){console.log("stop playing.")},sync:function(){console.log("check the playlist status"),this.playlist.length===this.playIdx&&this.playlist.fetch()},changePlaylist:function(){console.log("change playlist");for(var b=1;b<=window.playlist.length;b++){var c=window.playlist.get(b);a("#viewPlaylist").text(c.get("song"))}}}),i=new f,a(document).ready(function(){var c=window.localStorage.getItem("playlist");b.isNull(c)&&(window.playlist=new e,console.log("create empty playlist"));var f=chrome.extension.getBackgroundPage();window.music=f.music;var j=window.localStorage.getItem("sid");null==j||a(".login_dialog").hide();var k=window.localStorage.getItem(window.music),l=(document.getElementById("album"),JSON.parse(k));"undefined"!=typeof l&&null!==l&&(document.getElementById("album").src=l.album_photo,a("#artist_name").text(l.artist_name),a("#album_name").text(l.album_name)),a("#stop").on("click",function(){chrome.extension.sendMessage({status:"stop"},function(a){console.log(a)})}),a("#play").on("click",function(){chrome.extension.sendMessage({status:"play"},function(a){console.log(a)})}),a("#pause").on("click",function(){chrome.extension.sendMessage({status:"pause"},function(a){console.log(a)})}),playlist.on("add",i.changePlaylist),a("#add").on("click",function(){var a=new d;a.set({id:1,album:l.album_name,artist:l.artist_name,song:l.song_name,link:l.song_link}),window.playlist.add(a)}),g=function(){a.ajax({type:"POST",url:tester.server,data:{acc:a("#acc").val(),pwd:a("#pwd").val(),login:1}}).done(function(b){1===parseInt(b.trim(),10)&&(a(".login_dialog").hide(),localStorage.setItem("sid",a("#acc").val()),console.log("log in success"))})},h=function(){localStorage.removeItem("sid"),console.log("logout")},a("#login").on("click",function(){g()}),a("#logout").on("click",h)})})}();